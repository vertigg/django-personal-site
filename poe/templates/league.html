{% load static %} {% load ladder_extras %}

<div class="container col-lg-11">
    {% if not characters %}
    <div class="form-row text-center p-5">
        <div class="col-12">
            <h3 class="p-3 text-center">Can't find any {{class_filter.class_name}} in this ladder</h3>
            <a class="btn btn-primary" href={% url 'poe:ladder_url' slug=active_league.slug %} role="button">Back to ladder</a>
        </div>
    </div>
    {% else %}
    <h1 class="ladder-title">
        <a href="{% if active_league.url %}{{active_league.url}}{% else %}{% endif %}" class="ladder-link">
            {% if 'kalandra' in active_league.name|lower %}<span class="strike">{{active_league.name}}</span> Heist League{% else %}{{active_league.name}} League{% endif %}
        </a>
    </h1>
    <table class="LadderTable">
        <thead>
            <tr class="LadderHeader">
                <th class="row-rank text-center compact-column">Rank</th>
                <th>Character</th>
                <th>Account</th>
                <th>Class
                    <form id="" method="get" class="float-right">{{class_filter.form.class_id}}</form>
                </th>
                <th class="text-center">Level</th>
                <th class="text-center">Progress</th>
                <th class="text-center">Experience</th>
                <th class="text-center">Life</th>
                <th class="text-center">ES</th>
                <th class="text-center"><abbr title="Unhinged estimation by unconfigured PoB">DPS</abbr></th>
                <th class="text-center compact-column">Skills</th>
                <th class="text-center compact-column">Last Update</th>
            </tr>
        </thead>
        <tbody>
            {% for character in characters %}
            <tr class="LadderRows{% if current_profile == character.profile.poe_profile %} {% endif %}{% if character.expired %} character-expired{% endif %}">
                <td class="text-center">{{forloop.counter0|add:page_obj.start_index}}</td>
                <td class="row-link">
                    <div class="cell-link" style="height:100%; width:100%">
                        {% if user.is_staff %}
                        <a href="{% url 'admin:poe_character_change' character.id %}">
                            <i class="fa-solid fa-wrench"></i>
                        </a>
                        {% endif %}
                        <a class="ladder-link" href="https://www.pathofexile.com/account/view-profile/{{character.profile.poe_profile}}/characters?characterName={{character.name}}">
                            {{character.name}}
                        </a>
                    </div>
                </td>
                <td class="row-link">
                    <a class="ladder-link" href="https://www.pathofexile.com/account/view-profile/{{character.profile.poe_profile}}/characters">
                        <div class="ladder-link">
                            {{character.profile.poe_profile}}
                        </div>
                    </a>
                </td>
                <td>
                    <img class="max-h-[25px] hidden lg:inline" src="{% get_static_prefix %}poe/img/characters/{{character.class_name}}_avatar.png">
                    <span>{{character.class_name}}</span>
                </td>
                <td class="text-center">{{character.level}}</td>

                {% with character|level_progress as level_progress %}
                <td style="width:50px" title="{{level_progress}}%">
                    <div class="progress progress-level">
                        <div class="progress-bar bg-info" role="progressbar" style="width: {{level_progress}}%;" aria-valuenow="{{level_progress}}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% endwith %}
                <td class="text-right">
                    <span class="mr-4">{{character.experience|space_separator}}</span>
                </td>
                <td class="text-center">
                    <span>{{character.life|default_if_none:"-"}}</span>
                </td>
                <td class="text-center">
                    <span>{{character.es|default_if_none:"-"}}</span>
                </td>

                <td class="text-center">
                    <div>{{character.combined_dps|float_compact_format|default_if_none:"-"}}</div>
                </td>

                <td class="max-w-[150px] min-w-max flex flex-row py-1 justify-center ">
                    {% for gem in character.gems.all %} <img class="active-skill" src="{{gem.icon}}" title="{{gem.name}}">{% endfor %}
                </td>
                <td class="compact-column" title="{{ character.modified|date:'c' }}">
                    {{ character.modified|date:"j F, H:i:s" }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% if is_paginated %} {% include "paginator.html" with item=page_obj%} {% endif %}
</div>
<div class="col-xs-12" style="height:50px;"></div>
{% endif %}