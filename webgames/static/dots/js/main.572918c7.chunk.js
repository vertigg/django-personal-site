(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{29:function(e,t,r){e.exports=r(52)},34:function(e,t,r){},52:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(22),l=r.n(o),c=(r(34),r(36),r(54)),u=r(55),i=r(56),s=r(3),d=r(25),b=r(7),m=r(18),E=r(26),f=r(27),p=r.n(f),v=r(2),h=r(13),g=24,y=(Math.round(20),10),O={EMPTY:0,RED:1,BLUE:2},C={login:"/api/login",signup:"/api/signup",history:"/api/history"};function j(e){var t="";return e.forEach(function(e){t+="".concat(e[1]*g+g/2,","),t+="".concat(e[0]*g+g/2," ")}),t.trim()}var k=r(45),w=function(e,t){var r=[],n=t.x,a=t.y;return n>0&&r.push(e[n-1][a]),n>0&&a<19&&r.push(e[n-1][a+1]),a<19&&r.push(e[n][a+1]),n<19&&a<19&&r.push(e[n+1][a+1]),n<19&&r.push(e[n+1][a]),n<19&&a>0&&r.push(e[n+1][a-1]),a>0&&r.push(e[n][a-1]),n>0&&a>0&&r.push(e[n-1][a-1]),r.filter(function(e){return e.color===t.color&&!e.isCaptured})},S={createGrid:function(){for(var e=[],t=0,r=0;r<20;r++){e[r]=[];for(var n=0;n<20;n++)e[r][n]={x:r,y:n,color:O.EMPTY,id:t,isClickable:!0,isCaptured:!1,isVertex:!1},t+=1}return e},detectCycle:function(e,t){var r=w(e,t),n=[],a=[],o={board:e,success:!1,borders:{blue:[],red:[]},capturedPoints:a,red:0,blue:0};return r.forEach(function(r){var a={},o={},l=[];a[t.id]=!0,o[t.id]=!0,l.push(t),function e(t,r,n,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6?arguments[6]:void 0;if(!n[r.id]){n[r.id]=!0,a[r.id]=!0,c.push(r);var u=w(t,r);o&&(u=u.filter(function(e){return e.id!==o.id}));for(var i=0;i<u.length;i++){var s=u[i];if(!n[s.id]&&e(t,s,n,a,r,l,c))return!0;if(a[s.id]&&s.id===l.id&&c.length>3)return!0}}return a[r.id]=!1,c.pop(r),!1}(e,r,a,o,t,t,l)&&n.push(l)}),n.length&&(n.sort(function(e,t){return e.length-t.length}),n.forEach(function(r){var n=r.map(function(e){return[e.x,e.y]}),l=[];e.forEach(function(e){e.forEach(function(e){-1===k(n,[e.x,e.y])&&l.push(e)})}),l.length&&l.some(function(e){return e.color!==t.color&&!e.isCaptured})&&(r.forEach(function(t){e[t.x][t.y].isVertex=!0}),l.forEach(function(r){a.push(r),r.color===O.EMPTY||r.color===t.color||r.isCaptured||(t.color===O.RED?o.red+=1:o.blue+=1),e[r.x][r.y].isClickable=!1,e[r.x][r.y].isCaptured=!0}),t.color===O.RED?o.borders.red.push(j(n)):o.borders.blue.push(j(n)))})),a.length&&(o.success=!0),o},checkClickableCells:function(e){return e.some(function(e){return e.some(function(e){return!0===e.isClickable})})}};var R={authorization:function(e,t){return{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}},apiPost:function(e){var t=X.getState().token;return null!==t.value?{crossDomain:!0,method:"POST",headers:{"Content-Type":"application/json",Authorization:"Token ".concat(t.value)},body:e}:{}},apiGet:function(){var e=X.getState().token;return null!==e.value?{method:"GET",headers:{Authorization:"Token ".concat(e.value)}}:{}}},N=function(){return{type:"SAVE_GAME_RESET"}},T=function(){return{type:"SAVE_GAME_BEGIN"}},_=function(){return{type:"SAVE_GAME_SUCCESS"}},A=function(e){return{type:"SAVE_GAME_ERROR",data:e}};function G(e){if(!e.ok)throw console.log(e.text()),Error(e.statusText);return e.text()}var x="START_GAME",F="UPDATE_CELL",M="CAPTURE_CELLS",D="END_GAME";function B(){return{type:x}}function V(e){return function(t,r){t({type:F,data:e});var n=r().game,a=n.board,o=n.borders,l=n.score,c=S.detectCycle(a,e);c.success&&(c.score={red:l.red+c.red,blue:l.blue+c.blue},c.borders={blue:Object(h.a)(o.blue).concat(Object(h.a)(c.borders.blue)),red:Object(h.a)(o.red).concat(Object(h.a)(c.borders.red))},t(function(e){return{type:M,data:e}}(c)));var u=r().game.score,i=null;(u.red>y||u.blue>y)&&(i=u.red>y?O.RED:O.BLUE),S.checkClickableCells(r().game.board)||(i=u.red===u.blue?O.EMPTY:u.red>u.blue?O.RED:O.BLUE),i&&(t(N()),t(function(e){return{type:D,data:e}}(i)))}}var U=O.BLUE,I={board:[],borders:{blue:[],red:[]},player:U,isFinished:!1,score:{red:0,blue:0},startedAt:null,endedAt:null,winner:0},L={games:[],loading:!1,saving:!1,saved:!1,error:null},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,t=arguments.length>1?arguments[1]:void 0,r=t.type,n=t.data;switch(r){case"SAVE_GAME_BEGIN":return Object(v.a)({},e,{saving:!0,saved:!1,error:null});case"SAVE_GAME_SUCCESS":return Object(v.a)({},e,{saving:!1,saved:!0,error:null});case"SAVE_GAME_ERROR":return Object(v.a)({},e,{saving:!1,saved:!1,error:n.message});case"SAVE_GAME_RESET":return Object(v.a)({},e,{saving:!1,saved:!1,error:null});case"RETRIEVE_HISTORY_BEGIN":return Object(v.a)({},e,{loading:!0,error:null});case"RETRIEVE_HISTORY_ERROR":return Object(v.a)({},e,{loading:!1,error:n.message});case"RETRIEVE_HISTORY_SUCCESS":return Object(v.a)({},e,{loading:!1,error:null,games:n});default:return e}},H="REMOVE_TOKEN";var Y={value:null},K={value:null,loading:!1,error:null},J=Object(b.c)({authStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,t=arguments.length>1?arguments[1]:void 0,r=t.type,n=t.data;switch(r){case"FETCH_TOKEN_BEGIN":return Object(v.a)({},e,{loading:!0,error:null});case"FETCH_TOKEN_SUCCESS":return Object(v.a)({},e,{loading:!1});case"FETCH_TOKEN_ERROR":return Object(v.a)({},e,{loading:!1,error:n});case H:return Object(v.a)({},e,{value:null,error:null});default:return e}},token:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,t=arguments.length>1?arguments[1]:void 0,r=t.type,n=t.data;switch(r){case"FETCH_TOKEN_SUCCESS":return Object(v.a)({},e,{value:n.token});case H:return Object(v.a)({},e,{value:null});default:return e}},game:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0,r=t.type,n=t.data;switch(r){case x:return Object(v.a)({},e,{board:S.createGrid(),borders:{blue:[],red:[]},player:U,isFinished:!1,score:{red:0,blue:0},startedAt:Math.round(Date.now()/1e3),winner:0,endedAt:null});case D:return Object(v.a)({},e,{isFinished:!0,endedAt:Math.round(Date.now()/1e3),board:e.board.map(function(e){return e.map(function(e){return e.isClickable?Object(v.a)({},e,{isClickable:!1}):e})}),winner:n});case M:return Object(v.a)({},e,{score:n.score,borders:n.borders,board:n.board});case F:return n.color=e.player,n.isClickable=!1,Object(v.a)({},e,{player:e.player===O.RED?O.BLUE:O.RED,board:e.board.map(function(t){return t.map(function(t){return t.id===n.id?Object(v.a)({},t,{isClickable:!1,color:e.player}):t})})});default:return e}},history:P}),z=function(e,t){return J(e,t)},W={key:"root",storage:p.a,whitelist:["token"]},q=Object(m.a)(W,z);var Q,X=Object(b.e)(q,Q,Object(b.d)(Object(b.a)(E.a),window.devToolsExtension?window.devToolsExtension():function(e){return e})),Z=Object(m.b)(X),$=r(8),ee=r(9),te=r(11),re=r(10),ne=r(12),ae=function(e){function t(){var e,r;Object($.a)(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(r=Object(te.a)(this,(e=Object(re.a)(t)).call.apply(e,[this].concat(a)))).handleClick=function(){var e=r.props,t=e.cell,n=e.isFinished,a=e.moveOnClick;t.isClickable&&!n&&a(t)},r}return Object(ne.a)(t,e),Object(ee.a)(t,[{key:"getComponentClasses",value:function(){var e=this.props.cell,t="";return e.color===O.EMPTY?t+="cell-empty":t+=e.color===O.RED?"cell-red":"cell-blue",e.isClickable&&(t+=" cell-active"),t}},{key:"render",value:function(){return a.a.createElement("div",{className:"cell-wrapper"},a.a.createElement("div",{role:"presentation",className:this.getComponentClasses(),onClick:this.handleClick,onKeyDown:this.handleClick}))}}]),t}(n.Component);var oe=Object(s.b)(function(e){return{isFinished:e.game.isFinished}},function(e){return{moveOnClick:function(t){return e(V(t))}}})(ae),le=function(e){function t(){var e,r;Object($.a)(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(r=Object(te.a)(this,(e=Object(re.a)(t)).call.apply(e,[this].concat(a)))).getClassName=function(){return r.props.color===O.RED?"border-red":"border-blue"},r}return Object(ne.a)(t,e),Object(ee.a)(t,[{key:"render",value:function(){var e=this.props.coords;return a.a.createElement("svg",{className:"borders"},a.a.createElement("polygon",{points:e,className:this.getClassName()}))}}]),t}(n.Component);var ce=Object(s.b)(function(e){return{board:e.game.board,borders:e.game.borders}})(function(e){var t=e.preview,r=e.previewBoard,n=e.previewBorders,o=e.board,l=e.borders,c={minWidth:20*g,maxWidth:20*g};t&&(o=r,l=n);var u=l,i=u.blue,s=u.red;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"board",style:c},i.map(function(e,t){return a.a.createElement(le,{key:"Blue:".concat(t),color:O.BLUE,coords:e})}),s.map(function(e,t){return a.a.createElement(le,{key:"Red:".concat(t),color:O.RED,coords:e})}),o.map(function(e){return e.map(function(e){return a.a.createElement(oe,{x:e.x,y:e.y,key:e.id,cell:e})})})))}),ue=r(53);Object(s.b)(function(e){return{token:e.token}},function(e){return{logout:function(){return e({type:H})}}})(function(e){var t=e.logout;return a.a.createElement(a.a.Fragment,null,null!==X.getState().token.value&&a.a.createElement("nav",{className:"navbar navbar-dark bg-dark justify-content-between"},a.a.createElement("h6",{className:"navbar-brand"},"Dots game"),a.a.createElement(ue.a,{to:"/login"},a.a.createElement("button",{type:"button",title:"Logout",className:"btn btn-primary",onClick:t},"Logout"))))});var ie=Object(s.b)(null,function(e){return{startNewGame:function(){return e(B())}}})(function(e){var t=e.startNewGame,r=e.title;return a.a.createElement("button",{type:"button",className:"btn btn-secondary form-control",onClick:t},r)});var se=Object(s.b)(function(e){return{score:e.game.score,player:e.game.player}},function(e){return{startNewGame:function(){return e(B())}}})(function(e){var t=e.score,r=1===e.player?"Red":"Blue";return a.a.createElement("div",null,a.a.createElement("p",null,"Score threshold: ",y),a.a.createElement("p",null,"Blue: ",t.blue),a.a.createElement("p",null,"Red: ",t.red),a.a.createElement("p",null,"Next move: ",r),a.a.createElement(ie,{title:"Reset game"}))});var de=Object(s.b)(null,function(e){return{saveGame:function(){return e(function(e){e(T());var t=X.getState().game,r={board:t.board,borders:t.borders,winner:t.winner,score:t.score,startedAt:t.startedAt,endedAt:t.endedAt};return fetch(C.history,R.apiPost(JSON.stringify(r))).then(G).then(function(t){e(_())}).catch(function(t){e(A(t))})})}}})(function(e){var t=e.saveGame,r=e.title;return a.a.createElement("button",{type:"button",onClick:t,className:"btn btn-secondary form-control"},r)});var be=Object(s.b)(function(e){return{history:e.history,winner:e.game.winner,score:e.game.score,player:e.game.player}},function(e){return{startNewGame:function(){return e(N())}}})(function(e){var t=e.winner,r=e.history,n=0!==t?"".concat(1===t?"Red":"Blue"," player won!"):"It's a tie!",o=r.saving,l=r.saved,c=r.error;return a.a.createElement(a.a.Fragment,null,c&&a.a.createElement("div",null,a.a.createElement("h3",null,c),a.a.createElement(de,{title:"Retry save"}),a.a.createElement(ie,{title:"Start new game"})),l&&a.a.createElement(a.a.Fragment,null,a.a.createElement("h1",null,"Game saved!"),a.a.createElement(ue.a,{to:"/history"},a.a.createElement("button",{type:"button",className:"btn btn-secondary form-control",label:"History"})),a.a.createElement(ie,{title:"Start new game"})),o&&!c&&a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"lds-ripple float-right "},a.a.createElement("div",null)),a.a.createElement("div",{className:"col-sm-8 float-left"},a.a.createElement("h1",null,"Saving"))),!o&&!l&&!c&&a.a.createElement(a.a.Fragment,null,a.a.createElement("h3",null,n),a.a.createElement(ie,{title:"Start new game"})))}),me=function(e){function t(){return Object($.a)(this,t),Object(te.a)(this,Object(re.a)(t).apply(this,arguments))}return Object(ne.a)(t,e),Object(ee.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.startNewGame)()}},{key:"render",value:function(){var e=this.props.isFinished;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"container m-4 mw-100 d-flex justify-content-center"},a.a.createElement("div",{className:"left-control m-2"},e?a.a.createElement(be,null):a.a.createElement(se,null)),a.a.createElement("div",null,a.a.createElement(ce,null))))}}]),t}(a.a.Component);var Ee=Object(s.b)(function(e){return{isFinished:e.game.isFinished,game:e.game,board:e.game.board,player:e.game.player}},function(e){return{startNewGame:function(){return e(B())}}})(me),fe=function(){return a.a.createElement(s.a,{store:X},a.a.createElement(d.a,{loading:null,persistor:Z},a.a.createElement(c.a,null,a.a.createElement(u.a,null,a.a.createElement(i.a,{component:Ee})))))};l.a.render(a.a.createElement(fe,null),document.getElementById("root"))}},[[29,2,1]]]);
//# sourceMappingURL=main.572918c7.chunk.js.map